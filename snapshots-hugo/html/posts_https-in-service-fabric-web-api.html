<!DOCTYPE html><html lang="en"><head><script type="text/javascript" async="" src="https://www.google-analytics.com/analytics.js"></script><script type="text/javascript" async="" src="https://www.googletagmanager.com/gtag/js?id=G-46LYETW5NE&amp;cx=c&amp;gtm=4e6240"></script><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant="" defer=""></script>
    <meta charset="utf-8">
    <title>HTTP &amp; HTTPS in Service Fabric Web API | void where_prohibited() { ... }</title>
    <meta name="description" content="A personal website for Matt Kotsenas">
    <meta name="HandheldFriendly" content="True">
    
    <meta property="og:title" content="HTTP &amp; HTTPS in Service Fabric Web API | void where_prohibited() { ... }">
    <meta property="og:description" content="A personal website for Matt Kotsenas">
    <meta property="og:type" content="article">
    <meta property="og:url" content="http://localhost:1313/posts/https-in-service-fabric-web-api/">
    <meta property="og:image" content="http://localhost:1313/img/cover.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="HTTP &amp; HTTPS in Service Fabric Web API | void where_prohibited() { ... }">
    <meta name="twitter:description" content="A personal website for Matt Kotsenas">
    <meta name="twitter:image" content="http://localhost:1313/img/cover.jpg">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/screen.css">
    <link rel="stylesheet" href="/css/hljs.css">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400">
    <link rel="stylesheet" href="/css/custom.css">
    <link rel="alternate" type="application/rss+xml" title="void where_prohibited() { ... }" href="/rss.xml">
    <link rel="me" href="https://hachyderm.io/@mattkotsenas">
    
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-8867357-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-8867357-1');
    </script>
    
  <style id="fit-vids-style">.fluid-width-video-wrapper{width:100%;position:relative;padding:0;}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper object,.fluid-width-video-wrapper embed {position:absolute;top:0;left:0;width:100%;height:100%;}</style></head>
  <body class="post-template nav-closed">
    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
      <span class="hidden">Close</span>
    </a>
    <ul>
      <li class="nav-any" role="presentation">
        <a href="/">Home</a>
      </li>
      <li class="nav-any" role="presentation">
        <a href="/about">About</a>
      </li>
      <li class="nav-any" role="presentation">
        <a href="/photos">Photos</a>
      </li>
    </ul>
    <a class="subscribe-button icon-feed" href="/rss.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>

    <div class="site-wrapper">

      
<header class="main-header post-head" style="background-image: url(/img/cover.jpg)">
  <nav class="main-nav overlay clearfix">
    
    <a class="blog-logo" href="/"><img src="/img/home.png" alt="void where_prohibited() { ... }"></a>
    
    <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
  </nav>
</header>


<main class="content" role="main">
  <article class="post">

    <header class="post-header">
      <h1 class="post-title">HTTP &amp; HTTPS in Service Fabric Web API</h1>
      <section class="post-meta">
        <time class="post-date" datetime="2016-April-27">27 April 2016</time>
        
        <a href="/tags/azure/">azure</a>, <a href="/tags/service-fabric/">service fabric</a>, <a href="/tags/.net/">.net</a>
        
      </section>
    </header>

    <section class="post-content">
      <h2 id="prerequisites">Prerequisites</h2>
<p>Before we start, here are the prerequisites for this article. These instructions were written and tested against the following versions of the Service Fabric API, though the code and techniques likely apply to other versions as well.</p>
<ol>
<li>Service Fabric SDK 2.0.135 and Runtime 5.0.135 installed from <a href="https://azure.microsoft.com/en-us/documentation/articles/service-fabric-get-started/">here</a></li>
<li>A Web API service based on <a href="https://azure.microsoft.com/en-us/documentation/articles/service-fabric-reliable-services-communication-webapi/">OWIN self-hosting</a>, which you can create by adding a new Web API service template from Visual Studio</li>
</ol>
<h2 id="getting-started">Getting Started</h2>
<p>If you’re creating your first Web API microservice in Service Fabric, you <a href="https://snyk.io/blog/10-reasons-to-use-https/">probably</a> want to add HTTPS support pretty early on. In my not-so-humble experience getting the boilerplate <code>ValuesController</code>
in the new project accessible over HTTPS took a lot longer than I expected, so here’s the approach I took. Hopefully this advice will ease the pain for you and also make your code more flexible in the future.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#cf222e">public</span> <span style="color:#cf222e">class</span> <span style="color:#1f2328">ValuesController</span> <span style="color:#1f2328">:</span> ApiController
</span></span><span style="display:flex;"><span><span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a">// GET api/values</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">public</span> IEnumerable<span style="color:#1f2328">&lt;</span><span style="color:#cf222e">string</span><span style="color:#1f2328">&gt;</span> Get<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#cf222e">new</span> <span style="color:#cf222e">string</span><span style="color:#1f2328">[]</span> <span style="color:#1f2328">{</span> <span style="color:#0a3069">"value1"</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">"value2"</span> <span style="color:#1f2328">};</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a">// GET api/values/5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">public</span> <span style="color:#cf222e">string</span> Get<span style="color:#1f2328">(</span><span style="color:#cf222e">int</span> id<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#0a3069">"value"</span><span style="color:#1f2328">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a">// POST api/values</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">public</span> <span style="color:#cf222e">void</span> Post<span style="color:#1f2328">([</span>FromBody<span style="color:#1f2328">]</span><span style="color:#cf222e">string</span> <span style="color:#cf222e">value</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a">// PUT api/values/5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">public</span> <span style="color:#cf222e">void</span> Put<span style="color:#1f2328">(</span><span style="color:#cf222e">int</span> id<span style="color:#1f2328">,</span> <span style="color:#1f2328">[</span>FromBody<span style="color:#1f2328">]</span><span style="color:#cf222e">string</span> <span style="color:#cf222e">value</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a">// DELETE api/values/5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">public</span> <span style="color:#cf222e">void</span> Delete<span style="color:#1f2328">(</span><span style="color:#cf222e">int</span> id<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">}</span>
</span></span></code></pre></div><p><em>The ‘Hello World’ controller for new Web API projects</em></p>
<h3 id="step-1-add-an-https-endpoint-to-the-service-and-application-manifests">Step 1: Add an HTTPS endpoint to the Service and Application manifests</h3>
<h5 id="make-sure-you-have-a-certificate-in-your-service-fabric-cluster">Make sure you have a certificate in your Service Fabric cluster</h5>
<p>If you followed the <a href="https://azure.microsoft.com/en-us/documentation/articles/service-fabric-cluster-security/">Secure a Service Fabric cluster docs</a> then you already have the management certificate that you can reuse for this purpose. If your cluster is insecure, then go back and fix that first!</p>
<h5 id="add-the-certificate-to-the-localmachinemy-store-on-your-dev-machine-for-debugging">Add the certificate to the LocalMachine\My store on your dev machine for debugging</h5>
<p>According to <a href="https://azure.microsoft.com/en-us/documentation/articles/service-fabric-cluster-security/">the docs</a> the certificate should be added to <code>CurrentUser\My</code> and <code>CurrentUser\TrustedPeople</code>, however I also had to add the certificate to <code>LocalMachine\My</code> in order to debug on the local cluster. This is because the Service Fabric local cluster runs as <strong>NETWORK SERVICE</strong> and not as your user account. The PowerShell command to import the certificate is</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#6639ba">Import-PfxCertificate</span> -Exportable -CertStoreLocation Cert<span style="color:#f6f8fa;background-color:#82071e">:</span><span style="color:#1f2328">\</span>LocalMachine<span style="color:#1f2328">\</span>My -FilePath C:<span style="color:#1f2328">\</span>path<span style="color:#1f2328">\</span>to<span style="color:#1f2328">\</span>cert<span style="color:#1f2328">.</span>pfx -Password <span style="color:#1f2328">(</span><span style="color:#6639ba">Read-Host</span> -AsSecureString -Prompt <span style="color:#0a3069">"Enter Certificate Password"</span><span style="color:#1f2328">)</span>
</span></span></code></pre></div><blockquote>
<p>NOTE: I think this isn’t part of the MSDN setup because it’s possible your cluster won’t ever open HTTPS ports (e.g. uses only queues, binary protocols, etc.).
Thus I’m not sure where this should go in the docs. If you find a good place for it, let me know!</p></blockquote>
<h5 id="update-servicemanifestxml-and-applicationmanifestxml">Update ServiceManifest.xml and ApplicationManifest.xml</h5>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/service-fabric-service-manifest-resources/">Follow the instructions</a> on updating your <code>ServiceManifest.xml</code> and <code>ApplicationManifest.xml</code>. This tells the Service Fabric cluster that you intend to open an HTTPS port and to ensure the SSL certificate is available. After you’re done your manifests’ diffs should look similar to this</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-diff" data-lang="diff"><span style="display:flex;"><span>diff --git a/SampleWebApi/PackageRoot/ServiceManifest.xml b/SampleWebApi/PackageRoot/ServiceManifest.xml
</span></span><span style="display:flex;"><span>index b6d1453..4fce186 100644
</span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9">--- a/SampleWebApi/PackageRoot/ServiceManifest.xml
</span></span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9"></span><span style="color:#116329;background-color:#dafbe1">+++ b/SampleWebApi/PackageRoot/ServiceManifest.xml
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1"></span>@@ -29,6 +29,7 @@
</span></span><span style="display:flex;"><span>            listen. Please note that if your service is partitioned, this port is shared with
</span></span><span style="display:flex;"><span>            replicas of different partitions that are placed in your code. --&gt;
</span></span><span style="display:flex;"><span>             &lt;Endpoint Protocol="http" Name="ServiceEndpoint" Type="Input" Port="8521" /&gt;
</span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1">+            &lt;Endpoint Protocol="https" Name="ServiceEndpointHttps" Type="Input" Port="443" /&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1"></span>         &lt;/Endpoints&gt;
</span></span><span style="display:flex;"><span>     &lt;/Resources&gt;
</span></span><span style="display:flex;"><span> &lt;/ServiceManifest&gt;
</span></span><span style="display:flex;"><span>\ No newline at end of file
</span></span><span style="display:flex;"><span>diff --git a/SampleServiceFabric/ApplicationPackageRoot/ApplicationManifest.xml b/SampleServiceFabric/ApplicationPackageRoot/ApplicationManifest.xml
</span></span><span style="display:flex;"><span>index 145b554..2ab00c2 100644
</span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9">--- a/SampleServiceFabric/ApplicationPackageRoot/ApplicationManifest.xml
</span></span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9"></span><span style="color:#116329;background-color:#dafbe1">+++ b/SampleServiceFabric/ApplicationPackageRoot/ApplicationManifest.xml
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1"></span>@@ -6,6 +6,9 @@
</span></span><span style="display:flex;"><span>    &lt;ServiceManifestImport&gt;
</span></span><span style="display:flex;"><span>       &lt;ServiceManifestRef ServiceManifestName="SampleWebApiPkg" ServiceManifestVersion="1.0.0" /&gt;
</span></span><span style="display:flex;"><span>       &lt;ConfigOverrides /&gt;
</span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1">+      &lt;Policies&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1">+         &lt;EndpointBindingPolicy EndpointRef="ServiceEndpointHttps" CertificateRef="MyCert" /&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1">+      &lt;/Policies&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1"></span>    &lt;/ServiceManifestImport&gt;
</span></span><span style="display:flex;"><span>    &lt;DefaultServices&gt;
</span></span><span style="display:flex;"><span>       &lt;Service Name="SampleWebApi"&gt;
</span></span><span style="display:flex;"><span>@@ -14,4 +17,7 @@
</span></span><span style="display:flex;"><span>          &lt;/StatelessService&gt;
</span></span><span style="display:flex;"><span>       &lt;/Service&gt;
</span></span><span style="display:flex;"><span>    &lt;/DefaultServices&gt;
</span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1">+   &lt;Certificates&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1">+      &lt;EndpointCertificate X509FindValue="1234567890ABCDEFEDCBA0987654321AABBCCDDE" Name="MyCert" /&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1">+   &lt;/Certificates&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1"></span> &lt;/ApplicationManifest&gt;
</span></span><span style="display:flex;"><span>\ No newline at end of file
</span></span></code></pre></div><h5 id="open-the-load-balancer-ports">Open the Load Balancer port(s)</h5>
<p>Navigate to your Azure Load Balancer (it was created automatically in the same resource group as your Service Fabric cluster) and add two new <strong>Load balancing rules</strong> and <strong>Probes</strong> if they don’t already exist</p>
<theader>
    </theader><table>
  <tbody><tr><th>Probe / LB Rule</th>
    <th>Name</th>
    <th>Port</th>
  
  </tr></tbody><tbody>
    <tr><td>Probe</td><td>WebApiHttp</td><td>HTTP on port 8521</td></tr>
    <tr><td>Probe</td><td>WebApiHttps</td><td>TCP on port 443</td></tr>
    <tr><td>LB Rule</td><td>WebApiHttp</td><td>TCP from port 80 to 8521</td></tr>
    <tr><td>LB Rule</td><td>WebApiHttps</td><td>TCP from port 443 to 443</td></tr>
  </tbody>
</table>
<p><img src="/img/https-in-service-fabric-web-api/load-balancer-port.png" alt="Azure Load Balancer HTTPS rule and probe" title="Azure Load Balancer HTTPS rule and probe"></p>
<h3 id="step-2-update-owincommunicationlistener">Step 2: Update OwinCommunicationListener</h3>
<p>Now we’ve got two service endpoints in our manifest. We’re done, right? Unfortunately, if you look at the Diagnostic Events for your service you should see logs similar to this</p>
<theader>
    </theader><table>
  <tbody><tr><th>Timestamp</th>
    <th>Event Name</th>
    <th>Message</th>
  
  </tr></tbody><tbody>
    <tr><td>18:47:57.040</td><td>StatelessRunAsyncCompletion</td><td>RunAsync has successfully completed for a stateless service instance</td></tr>
    <tr><td>18:47:57.032</td><td>StatelessRunAsyncInvocation</td><td>RunAsync has been invoked for a stateless service instance</td></tr>
    <tr><td>18:47:57.008</td><td>ServiceMessage</td><td>Listening on Http://10.0.0.4:8521/</td></tr>
    <tr><td>18:47:56.003</td><td>ServiceMessage</td><td>Starting web server on Http://+:8521/</td></tr>
    <tr><td>18:47:55.904</td><td>ServiceTypeRegistered</td><td>Service host process 4472 register service type</td></tr>
  </tbody>
</table>
<p>Look like the service is still only listening for on the HTTP endpoint. If you jump to <code>OwinCommunicationListener::OpenAsync()</code> you should see code that looks like this</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#cf222e">public</span> Task<span style="color:#1f2328">&lt;</span><span style="color:#cf222e">string</span><span style="color:#1f2328">&gt;</span> OpenAsync<span style="color:#1f2328">(</span>CancellationToken cancellationToken<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">var</span> serviceEndpoint <span style="color:#1f2328">=</span> <span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>serviceContext<span style="color:#1f2328">.</span>CodePackageActivationContext<span style="color:#1f2328">.</span>GetEndpoint<span style="color:#1f2328">(</span><span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>endpointName<span style="color:#1f2328">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">int</span> port <span style="color:#1f2328">=</span> serviceEndpoint<span style="color:#1f2328">.</span>Port<span style="color:#1f2328">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> <span style="color:#1f2328">(</span><span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>serviceContext <span style="color:#cf222e">is</span> StatefulServiceContext<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        StatefulServiceContext statefulServiceContext <span style="color:#1f2328">=</span> <span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>serviceContext <span style="color:#cf222e">as</span> StatefulServiceContext<span style="color:#1f2328">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>listeningAddress <span style="color:#1f2328">=</span> <span style="color:#cf222e">string</span><span style="color:#1f2328">.</span>Format<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>            CultureInfo<span style="color:#1f2328">.</span>InvariantCulture<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">"http://+:{0}/{1}{2}/{3}/{4}"</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            port<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">string</span><span style="color:#1f2328">.</span>IsNullOrWhiteSpace<span style="color:#1f2328">(</span><span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>appRoot<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#1f2328">?</span> <span style="color:#cf222e">string</span><span style="color:#1f2328">.</span>Empty
</span></span><span style="display:flex;"><span>                <span style="color:#1f2328">:</span> <span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>appRoot<span style="color:#1f2328">.</span>TrimEnd<span style="color:#1f2328">(</span><span style="color:#0a3069">'/'</span><span style="color:#1f2328">)</span> <span style="color:#1f2328">+</span> <span style="color:#0a3069">'/'</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            statefulServiceContext<span style="color:#1f2328">.</span>PartitionId<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            statefulServiceContext<span style="color:#1f2328">.</span>ReplicaId<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            Guid<span style="color:#1f2328">.</span>NewGuid<span style="color:#1f2328">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">else</span> <span style="color:#cf222e">if</span> <span style="color:#1f2328">(</span><span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>serviceContext <span style="color:#cf222e">is</span> StatelessServiceContext<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>listeningAddress <span style="color:#1f2328">=</span> <span style="color:#cf222e">string</span><span style="color:#1f2328">.</span>Format<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>            CultureInfo<span style="color:#1f2328">.</span>InvariantCulture<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">"http://+:{0}/{1}"</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            port<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">string</span><span style="color:#1f2328">.</span>IsNullOrWhiteSpace<span style="color:#1f2328">(</span><span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>appRoot<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#1f2328">?</span> <span style="color:#cf222e">string</span><span style="color:#1f2328">.</span>Empty
</span></span><span style="display:flex;"><span>                <span style="color:#1f2328">:</span> <span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>appRoot<span style="color:#1f2328">.</span>TrimEnd<span style="color:#1f2328">(</span><span style="color:#0a3069">'/'</span><span style="color:#1f2328">)</span> <span style="color:#1f2328">+</span> <span style="color:#0a3069">'/'</span><span style="color:#1f2328">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">throw</span> <span style="color:#cf222e">new</span> InvalidOperationException<span style="color:#1f2328">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>publishAddress <span style="color:#1f2328">=</span> <span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>listeningAddress<span style="color:#1f2328">.</span>Replace<span style="color:#1f2328">(</span><span style="color:#0a3069">"+"</span><span style="color:#1f2328">,</span> FabricRuntime<span style="color:#1f2328">.</span>GetNodeContext<span style="color:#1f2328">().</span>IPAddressOrFQDN<span style="color:#1f2328">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">try</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>eventSource<span style="color:#1f2328">.</span>ServiceMessage<span style="color:#1f2328">(</span><span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>serviceContext<span style="color:#1f2328">,</span> <span style="color:#0a3069">"Starting web server on "</span> <span style="color:#1f2328">+</span> <span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>listeningAddress<span style="color:#1f2328">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>webApp <span style="color:#1f2328">=</span> WebApp<span style="color:#1f2328">.</span>Start<span style="color:#1f2328">(</span><span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>listeningAddress<span style="color:#1f2328">,</span> appBuilder <span style="color:#1f2328">=&gt;</span> <span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>startup<span style="color:#1f2328">.</span>Invoke<span style="color:#1f2328">(</span>appBuilder<span style="color:#1f2328">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>eventSource<span style="color:#1f2328">.</span>ServiceMessage<span style="color:#1f2328">(</span><span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>serviceContext<span style="color:#1f2328">,</span> <span style="color:#0a3069">"Listening on "</span> <span style="color:#1f2328">+</span> <span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>publishAddress<span style="color:#1f2328">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> Task<span style="color:#1f2328">.</span>FromResult<span style="color:#1f2328">(</span><span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>publishAddress<span style="color:#1f2328">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">catch</span> <span style="color:#1f2328">(</span>Exception ex<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>eventSource<span style="color:#1f2328">.</span>ServiceMessage<span style="color:#1f2328">(</span><span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>serviceContext<span style="color:#1f2328">,</span> <span style="color:#0a3069">"Web server failed to open. "</span> <span style="color:#1f2328">+</span> ex<span style="color:#1f2328">.</span>ToString<span style="color:#1f2328">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>StopWebServer<span style="color:#1f2328">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">throw</span><span style="color:#1f2328">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">}</span>
</span></span></code></pre></div><p>Interestingly, the <code>this.listeningAddress</code> has “http” hardcoded! We can update this code to pull the protocol from the endpoint definition in the manifest, and while we’re at it, let’s add some additional logging which will come in handy later. The diff should look like this</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-diff" data-lang="diff"><span style="display:flex;"><span>diff --git a/SampleWebApi/OwinCommunicationListener.cs b/SampleWebApi/OwinCommunicationListener.cs
</span></span><span style="display:flex;"><span>index 9b5d2ad..f849da4 100644
</span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9">--- a/SampleWebApi/OwinCommunicationListener.cs
</span></span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9"></span><span style="color:#116329;background-color:#dafbe1">+++ b/SampleWebApi/OwinCommunicationListener.cs
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1"></span>@@ -59,16 +59,22 @@ namespace SampleWebApi
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>         public Task&lt;string&gt; OpenAsync(CancellationToken cancellationToken)
</span></span><span style="display:flex;"><span>         {
</span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1">+            this.eventSource.ServiceMessage(this.serviceContext, "Calling OpenAsync on endpoint {0}", this.endpointName);
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1">+
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1"></span>             var serviceEndpoint = this.serviceContext.CodePackageActivationContext.GetEndpoint(this.endpointName);
</span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1">+            var protocol = serviceEndpoint.Protocol;
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1"></span>             int port = serviceEndpoint.Port;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1">+            this.eventSource.ServiceMessage(this.serviceContext, "Found endpoint with protocol '{0}' port '{1}'", protocol, port);
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1">+
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1"></span>             if (this.serviceContext is StatefulServiceContext)
</span></span><span style="display:flex;"><span>             {
</span></span><span style="display:flex;"><span>                 StatefulServiceContext statefulServiceContext = this.serviceContext as StatefulServiceContext;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>                 this.listeningAddress = string.Format(
</span></span><span style="display:flex;"><span>                     CultureInfo.InvariantCulture,
</span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9">-                    "http://+:{0}/{1}{2}/{3}/{4}",
</span></span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9"></span><span style="color:#116329;background-color:#dafbe1">+                    "{0}://+:{1}/{2}{3}/{4}/{5}",
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1">+                    protocol,
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1"></span>                     port,
</span></span><span style="display:flex;"><span>                     string.IsNullOrWhiteSpace(this.appRoot)
</span></span><span style="display:flex;"><span>                         ? string.Empty
</span></span><span style="display:flex;"><span>@@ -81,7 +87,8 @@ namespace SampleWebApi
</span></span><span style="display:flex;"><span>             {
</span></span><span style="display:flex;"><span>                 this.listeningAddress = string.Format(
</span></span><span style="display:flex;"><span>                     CultureInfo.InvariantCulture,
</span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9">-                    "http://+:{0}/{1}",
</span></span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9"></span><span style="color:#116329;background-color:#dafbe1">+                    "{0}://+:{1}/{2}",
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1">+                    protocol,
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1"></span>                     port,
</span></span><span style="display:flex;"><span>                     string.IsNullOrWhiteSpace(this.appRoot)
</span></span><span style="display:flex;"><span>                         ? string.Empty
</span></span><span style="display:flex;"><span>@@ -106,7 +113,7 @@ namespace SampleWebApi
</span></span><span style="display:flex;"><span>             }
</span></span><span style="display:flex;"><span>             catch (Exception ex)
</span></span><span style="display:flex;"><span>             {
</span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9">-                this.eventSource.ServiceMessage(this.serviceContext, "Web server failed to open. " + ex.ToString());
</span></span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9"></span><span style="color:#116329;background-color:#dafbe1">+                this.eventSource.ServiceMessage(this.serviceContext, "Web server for endpoint {0} failed to open. {1}", this.endpointName, ex.ToString());
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1"></span> 
</span></span><span style="display:flex;"><span>                 this.StopWebServer();
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>@@ -116,7 +123,7 @@ namespace SampleWebApi
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>         public Task CloseAsync(CancellationToken cancellationToken)
</span></span><span style="display:flex;"><span>         {
</span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9">-            this.eventSource.ServiceMessage(this.serviceContext, "Closing web server");
</span></span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9"></span><span style="color:#116329;background-color:#dafbe1">+            this.eventSource.ServiceMessage(this.serviceContext, "Closing web server for endpoint {0}", this.endpointName);
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1"></span> 
</span></span><span style="display:flex;"><span>             this.StopWebServer();
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>@@ -125,7 +132,7 @@ namespace SampleWebApi
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>         public void Abort()
</span></span><span style="display:flex;"><span>         {
</span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9">-            this.eventSource.ServiceMessage(this.serviceContext, "Aborting web server");
</span></span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9"></span><span style="color:#116329;background-color:#dafbe1">+            this.eventSource.ServiceMessage(this.serviceContext, "Aborting web server for endpoint {0}", this.endpointName);
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1"></span> 
</span></span><span style="display:flex;"><span>             this.StopWebServer();
</span></span><span style="display:flex;"><span>         }
</span></span></code></pre></div><h3 id="step-3-update-createserviceinstancelisteners">Step 3: Update CreateServiceInstanceListeners()</h3>
<p>OK, now we’re done, right? Not quite. If you debug your service you’ll again see that the <code>OwinCommunicationListener</code> is only attempting to listen on the <strong>ServiceEndpoint</strong>, not on our new <strong>ServiceEndpointHttps</strong>. After much fruitless debugging I stumbled upon the code in <code>SampleWebApi</code> (or whatever your <code>StatelessService</code> is called). Take a look at <code>CreateServiceInstanceListeners()</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#57606a">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">/// Optional override to create listeners (like tcp, http) for this service instance.</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">/// &lt;returns&gt;The collection of listeners.&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">protected</span> <span style="color:#cf222e">override</span> IEnumerable<span style="color:#1f2328">&lt;</span>ServiceInstanceListener<span style="color:#1f2328">&gt;</span> CreateServiceInstanceListeners<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> <span style="color:#cf222e">new</span><span style="color:#1f2328">[]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">new</span> ServiceInstanceListener<span style="color:#1f2328">(</span>serviceContext <span style="color:#1f2328">=&gt;</span> <span style="color:#cf222e">new</span> OwinCommunicationListener<span style="color:#1f2328">(</span>Startup<span style="color:#1f2328">.</span>ConfigureApp<span style="color:#1f2328">,</span> serviceContext<span style="color:#1f2328">,</span> ServiceEventSource<span style="color:#1f2328">.</span>Current<span style="color:#1f2328">,</span> <span style="color:#0a3069">"ServiceEndpoint"</span><span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">};</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">}</span>
</span></span></code></pre></div><p>Again with the hardcoding! This time we’re assuming there’s an endpoint in <code>ServiceManifest.xml</code> named “ServiceEndpoint”. Let’s fix this up again so that we create a listener for each endpoint</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-diff" data-lang="diff"><span style="display:flex;"><span>diff --git a/SampleWebApi/SampleWebApi.cs b/SampleWebApi/SampleWebApi.cs
</span></span><span style="display:flex;"><span>index 18137a6..55a7866 100644
</span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9">--- a/SampleWebApi/SampleWebApi.cs
</span></span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9"></span><span style="color:#116329;background-color:#dafbe1">+++ b/SampleWebApi/SampleWebApi.cs
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1"></span>@@ -1,5 +1,8 @@
</span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9">-using System.Collections.Generic;
</span></span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9"></span><span style="color:#116329;background-color:#dafbe1">+using System;
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1">+using System.Collections.Generic;
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1"></span> using System.Fabric;
</span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1">+using System.Fabric.Description;
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1">+using System.Linq;
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1"></span> using Microsoft.ServiceFabric.Services.Communication.Runtime;
</span></span><span style="display:flex;"><span> using Microsoft.ServiceFabric.Services.Runtime;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>@@ -20,10 +23,12 @@ namespace SampleWebApi
</span></span><span style="display:flex;"><span>         /// &lt;returns&gt;The collection of listeners.&lt;/returns&gt;
</span></span><span style="display:flex;"><span>         protected override IEnumerable&lt;ServiceInstanceListener&gt; CreateServiceInstanceListeners()
</span></span><span style="display:flex;"><span>         {
</span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9">-            return new[]
</span></span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9">-            {
</span></span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9">-                new ServiceInstanceListener(serviceContext =&gt; new OwinCommunicationListener(Startup.ConfigureApp, serviceContext, ServiceEventSource.Current, "ServiceEndpoint"))
</span></span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9">-            };
</span></span></span><span style="display:flex;"><span><span style="color:#82071e;background-color:#ffebe9"></span><span style="color:#116329;background-color:#dafbe1">+            var endpoints = Context.CodePackageActivationContext.GetEndpoints()
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1">+                                   .Where(endpoint =&gt; endpoint.Protocol == EndpointProtocol.Http || endpoint.Protocol == EndpointProtocol.Https)
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1">+                                   .Select(endpoint =&gt; endpoint.Name);
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1">+
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1">+            return endpoints.Select(endpoint =&gt; new ServiceInstanceListener(
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1">+                serviceContext =&gt; new OwinCommunicationListener(Startup.ConfigureApp, serviceContext, ServiceEventSource.Current, endpoint), endpoint));
</span></span></span><span style="display:flex;"><span><span style="color:#116329;background-color:#dafbe1"></span>         }
</span></span><span style="display:flex;"><span>     }
</span></span><span style="display:flex;"><span> }
</span></span></code></pre></div><p>This creates an endpoint for each HTTP / HTTPS endpoint found in the manifest. Additionally we name the <code>ServiceInstanceListener</code> the name of the endpoint since by default it has a blank name, and each listener must have a unique name.</p>
<h2 id="wrap-up">Wrap Up</h2>
<p>Phew! That should do it. Your Web API service should now be available over both HTTP and HTTPS for both local debugging and in the Service Fabric cluster.</p>
<p>I’m new to Service Fabric myself, so it’s possible I’ve done something boneheaded in the steps. If so, feel free to reach out to me at <a href="https://twitter.com/MattKotsenas">@MattKotsenas</a>, or send a PR with fixes!</p>
<h2 id="pull-requests">Pull Requests</h2>
<p>Just for funsies, here are the Pull Requests opened while developing this article</p>
<ul>
<li><a href="https://github.com/Azure/azure-content/pull/6405">[PR 6405]</a> Fix typos in Import-PfxCertificate calls in service-fabric-cluster-security</li>
<li><a href="https://github.com/Azure/azure-content/pull/6415">[PR 6415]</a> Update OwinCommunicationListener to support HTTP or HTTPS endpoints</li>
<li><a href="https://github.com/Azure/azure-content/pull/6416">[PR 6416]</a> Log endpoint name in OwinCommunicationListener</li>
<li><a href="https://github.com/Azure/azure-content/pull/6417">[PR 6417]</a> Remove hardcoded endpoint names in CreateServiceInstanceListeners()</li>
</ul>

    </section>

    <footer class="post-footer">

      
      <figure class="author-image">
        <a class="img" href="/" style="background-image: url(https://gravatar.com/avatar/13e6e96d176cd18ef232d054b8e65f55)"><span class="hidden">Matt Kotsenas's Picture</span></a>
      </figure>
      

      <section class="author">
        <h4><a href="/">Matt Kotsenas</a></h4>

        <div class="author-meta">
          
          <span class="author-location icon-location">Seattle, WA</span>
          
        </div>
      </section>

      <section class="share">
        <h4>Share / feeds</h4>
        <a class="icon-twitter" href="https://twitter.com/intent/tweet?text=HTTP+%26+HTTPS+in+Service+Fabric+Web+API&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fhttps-in-service-fabric-web-api%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <span class="hidden">Twitter</span>
        </a>
        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fhttps-in-service-fabric-web-api%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <span class="hidden">Facebook</span>
        </a>
        <a class="icon-feed" href="/rss.xml">
          <span class="hidden">RSS</span>
        </a>
      </section>
      <section>
        <div>
          <em>
            Did I make a mistake? Do you have a better idea? Please, help make the web better by sending me corrections at <a class="icon-github" href="https://github.com/MattKotsenas/MattKotsenas"><span class="hidden">GitHub</span></a>.
          </em>
        </div>
      </section>
    </footer>

  </article>
</main>

<aside class="read-next">
  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
        
        <a class="read-next-story" style="background-image: url(/img/cover.jpg)" href="http://localhost:1313/posts/running-docpad-on-azure-in-2015/">
          <section class="post">
            <h2>Running docpad on Azure in 2015</h2>
            <p></p><h2 id="why-docpad">Why docpad</h2>
<p>I really needed to freshen up the site. It was created hastily and really didn’t …</p>…<p></p>
          </section>
        </a>
      
      
        
        <a class="read-next-story prev" style="background-image: url(/img/cover.jpg)" href="http://localhost:1313/posts/powershell-dynamicproxy-indexers/">
          </a><section class="post"><a class="read-next-story prev" style="background-image: url(/img/cover.jpg)" href="http://localhost:1313/posts/powershell-dynamicproxy-indexers/">
            <h2>The curious case of PowerShell, Castle DynamicProxy and indexers</h2>
            <p></p></a><blockquote><a class="read-next-story prev" style="background-image: url(/img/cover.jpg)" href="http://localhost:1313/posts/powershell-dynamicproxy-indexers/">
</a><p><a class="read-next-story prev" style="background-image: url(/img/cover.jpg)" href="http://localhost:1313/posts/powershell-dynamicproxy-indexers/">UPDATE: This issue is now </a><a href="https://windowsserver.uservoice.com/forums/301869-powershell/suggestions/15425352--bug-castle-s-dynamicproxy-breaks-property-indexe?tracking_code=29201113a860fa7a2196756b8e488001">tracked in uservoice</a>. If it’s affecting you, please upvote! …</p></blockquote>…<p></p>
          </section>
        
      
    
  
    
  
    
  
    
  
</aside>


      <footer class="site-footer clearfix">
        <section class="copyright"><a href="/">void where_prohibited() { ... }</a> © 2026</section>
      </footer>

    </div>
    <script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="/js/jquery.fitvids.js"></script>
    <script src="/js/index.js"></script>
  

</body></html>