{{ define "main" }}
{{ partial "masthead.html" . }}

<main class="content" role="main">
  <article class="post">

    <header class="post-header">
      <h1 class="post-title">{{ .Title }}</h1>
      <section class="post-meta">
        <time class="post-date" datetime="{{ .Date.Format "2006-January-02" }}">{{ .Date.Format "02 January 2006" }}</time>
        {{ with .Params.tags }}
        {{ range $i, $tag := . }}{{ if $i }}, {{ end }}<a href="/tags/{{ $tag | urlize }}/">{{ $tag }}</a>{{ end }}
        {{ end }}
      </section>
    </header>

    <section class="post-content">
      {{ .Content }}
    </section>

    <footer class="post-footer">

      {{ with $.Site.Params.authorImg }}
      <figure class="author-image">
        <a class="img" href="/" style="background-image: url({{ . }})"><span class="hidden">{{ $.Site.Params.author }}'s Picture</span></a>
      </figure>
      {{ end }}

      <section class="author">
        <h4><a href="/">{{ .Site.Params.author }}</a></h4>

        <div class="author-meta">
          {{ with .Site.Params.authorLocation }}
          <span class="author-location icon-location">{{ . }}</span>
          {{ end }}
        </div>
      </section>

      <section class="share">
        <h4>Share / feeds</h4>
        <a class="icon-twitter" href="https://twitter.com/intent/tweet?text={{ .Title | urlquery }}&amp;url={{ .Permalink }}"
          onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <span class="hidden">Twitter</span>
        </a>
        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u={{ .Permalink }}"
          onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <span class="hidden">Facebook</span>
        </a>
        <a class="icon-feed" href="/rss.xml">
          <span class="hidden">RSS</span>
        </a>
      </section>
      <section>
        <div>
          <em>
            Did I make a mistake? Do you have a better idea? Please, help make the web better by sending me corrections at <a class="icon-github" href="https://github.com/MattKotsenas/MattKotsenas"><span class="hidden">GitHub</span></a>.
          </em>
        </div>
      </section>
    </footer>

  </article>
</main>

<aside class="read-next">
  {{ $posts := where .Site.RegularPages "Section" "posts" }}
  {{ range $i, $post := $posts }}
    {{ if eq $post.Permalink $.Permalink }}
      {{ if lt (add $i 1) (len $posts) }}
        {{ $next := index $posts (add $i 1) }}
        <a class="read-next-story" style="background-image: url({{ with $next.Params.cover }}{{ . }}{{ else }}{{ $.Site.Params.cover }}{{ end }})" href="{{ $next.Permalink }}">
          <section class="post">
            <h2>{{ $next.Title }}</h2>
            <p>{{ with $next.Params.excerpt }}{{ . }}{{ else }}{{ $next.Summary | plainify | truncate 100 }}{{ end }}&hellip;</p>
          </section>
        </a>
      {{ end }}
      {{ if gt $i 0 }}
        {{ $prev := index $posts (sub $i 1) }}
        <a class="read-next-story prev" style="background-image: url({{ with $prev.Params.cover }}{{ . }}{{ else }}{{ $.Site.Params.cover }}{{ end }})" href="{{ $prev.Permalink }}">
          <section class="post">
            <h2>{{ $prev.Title }}</h2>
            <p>{{ with $prev.Params.excerpt }}{{ . }}{{ else }}{{ $prev.Summary | plainify | truncate 100 }}{{ end }}&hellip;</p>
          </section>
        </a>
      {{ end }}
    {{ end }}
  {{ end }}
</aside>
{{ end }}
